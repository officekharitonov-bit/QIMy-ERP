# ‚úÖ –ì–û–¢–û–í–û: –£–ª—É—á—à–µ–Ω–∏—è –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ QIM –≤–Ω–µ–¥—Ä–µ–Ω—ã!

## –î–∞—Ç–∞: 19 —è–Ω–≤–∞—Ä—è 2026

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. ‚úÖ ClientType (–¢–∏–ø –∫–ª–∏–µ–Ω—Ç–∞)
**Enum –¥–æ–±–∞–≤–ª–µ–Ω:**
```csharp
public enum ClientType
{
    B2B = 1,          // –ë–∏–∑–Ω–µ—Å
    B2C = 2,          // –ß–∞—Å—Ç–Ω–æ–µ –ª–∏—Ü–æ
    Government = 3,   // –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ
    Nonprofit = 4     // –ù–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è
}
```

### 2. ‚úÖ ClientArea (–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å)
**Enum –¥–æ–±–∞–≤–ª–µ–Ω:**
```csharp
public enum ClientArea
{
    Inland = 1,        // –ê–≤—Å—Ç—Ä–∏—è (200000-229999)
    EU = 2,            // –ï–° (230000-259999)
    ThirdCountry = 3   // –¢—Ä–µ—Ç—å–∏ —Å—Ç—Ä–∞–Ω—ã (260000-299999)
}
```

### 3. ‚úÖ ClientCode (–ê–≤—Ç–æ–Ω—É–º–µ—Ä–∞—Ü–∏—è)
**–ê–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:**
- **Inland (–ê–≤—Å—Ç—Ä–∏—è)**: 200000-229999
- **EU (–ï–°)**: 230000-259999
- **ThirdCountry (–¢—Ä–µ—Ç—å–∏ —Å—Ç—Ä–∞–Ω—ã)**: 260000-299999

**–ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```csharp
private async Task<int> GenerateNextClientCodeAsync(ClientArea clientArea)
{
    int baseCode = clientArea switch
    {
        ClientArea.Inland => 200000,
        ClientArea.EU => 230000,
        ClientArea.ThirdCountry => 260000,
        _ => 200000
    };

    int maxRange = baseCode + 29999;

    var maxCode = await _context.Clients
        .Where(c => c.ClientCode >= baseCode && c.ClientCode <= maxRange)
        .MaxAsync(c => (int?)c.ClientCode);

    return maxCode.HasValue ? maxCode.Value + 1 : baseCode;
}
```

### 4. ‚úÖ UI –û–±–Ω–æ–≤–ª–µ–Ω
**–§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (CreateEdit.razor):**
- Dropdown –¥–ª—è –≤—ã–±–æ—Ä–∞ ClientType
- Dropdown –¥–ª—è –≤—ã–±–æ—Ä–∞ ClientArea
- Read-only –ø–æ–ª–µ ClientCode
- VIES –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ (Index.razor):**
- –ö–æ–ª–æ–Ω–∫–∞ "–ö–æ–¥" —Å ClientCode
- –ö–æ–ª–æ–Ω–∫–∞ "–¢–∏–ø / –û–±–ª–∞—Å—Ç—å" —Å badge –∏ —ç–º–æ–¥–∑–∏:
  - üá¶üáπ Inland (–ê–≤—Å—Ç—Ä–∏—è)
  - üá™üá∫ EU (–ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–π –°–æ—é–∑)
  - üåç Drittland (–¢—Ä–µ—Ç—å–∏ —Å—Ç—Ä–∞–Ω—ã)

### 5. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
```sql
ALTER TABLE [Clients] ADD [ClientArea] int NOT NULL DEFAULT 0;
ALTER TABLE [Clients] ADD [ClientCode] int NULL;
ALTER TABLE [Clients] ADD [ClientType] int NOT NULL DEFAULT 0;
```

**–°—Ç–∞—Ç—É—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ –ü–æ–ª—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Azure SQL Database
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –ù–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ClientCode

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:5000/clients/create
2. –í—ã–±–µ—Ä–∏—Ç–µ **–¢–∏–ø –∫–ª–∏–µ–Ω—Ç–∞** (B2B/B2C/Government/Nonprofit)
3. –í—ã–±–µ—Ä–∏—Ç–µ **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –æ–±–ª–∞—Å—Ç—å** (Inland/EU/ThirdCountry)
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
5. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –ø—Ä–∏—Å–≤–æ–µ–Ω **ClientCode**

### –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ–Ω—É–º–µ—Ä–∞—Ü–∏–∏:
- –ü–µ—Ä–≤—ã–π –∞–≤—Å—Ç—Ä–∏–π—Å–∫–∏–π –∫–ª–∏–µ–Ω—Ç ‚Üí ClientCode: **200000**
- –í—Ç–æ—Ä–æ–π –∞–≤—Å—Ç—Ä–∏–π—Å–∫–∏–π –∫–ª–∏–µ–Ω—Ç ‚Üí ClientCode: **200001**
- –ü–µ—Ä–≤—ã–π –∫–ª–∏–µ–Ω—Ç –∏–∑ –ï–° ‚Üí ClientCode: **230000**
- –ü–µ—Ä–≤—ã–π –∫–ª–∏–µ–Ω—Ç –∏–∑ —Ç—Ä–µ—Ç—å–∏—Ö —Å—Ç—Ä–∞–Ω ‚Üí ClientCode: **260000**

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ —Å—Ç–∞—Ä—ã–º QIM

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ä—ã–π QIM | –ù–æ–≤—ã–π QIMy | –°—Ç–∞—Ç—É—Å |
|---------|-----------|-----------|--------|
| ClientCode | ‚úÖ Auto | ‚úÖ Auto | ‚úÖ |
| ClientType | ‚úÖ B2B/B2C | ‚úÖ B2B/B2C/Gov/NP | ‚úÖ –£–ª—É—á—à–µ–Ω–æ |
| ClientArea | ‚úÖ Inland/EU/3rd | ‚úÖ Inland/EU/3rd | ‚úÖ |
| VAT Check (VIES) | ‚úÖ SOAP | ‚úÖ SOAP | ‚úÖ |
| –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ | ‚úÖ focusout | ‚úÖ bind-Value:after | ‚úÖ –£–ª—É—á—à–µ–Ω–æ |
| –ù—É–º–µ—Ä–∞—Ü–∏—è | ‚úÖ SP | ‚úÖ C# async | ‚úÖ –ú–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ |

---

## üé® UI/UX —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ:
```
–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ | –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ | Email | –¢–µ–ª–µ—Ñ–æ–Ω | –ì–æ—Ä–æ–¥ | –î–µ–π—Å—Ç–≤–∏—è
```

### –ü–æ—Å–ª–µ:
```
–ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ | –¢–∏–ø / –û–±–ª–∞—Å—Ç—å | –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ | Email | –¢–µ–ª–µ—Ñ–æ–Ω | –î–µ–π—Å—Ç–≤–∏—è
200001 | CKHA GmbH | [B2B] üá¶üáπ Inland | - | - | - | [‚úèÔ∏è] [üóëÔ∏è]
```

---

## üî• –ß—Ç–æ –¥–∞–ª—å—à–µ?

### Phase 2 - CSV Export/Import
- –≠–∫—Å–ø–æ—Ä—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ CSV (–¥–ª—è BMD/Exact)
- –ò–º–ø–æ—Ä—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ CSV
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (;, ,, |)

### Phase 3 - PDF Reports
- QuestPDF –¥–ª—è —Å—á–µ—Ç–æ–≤
- –®–∞–±–ª–æ–Ω—ã —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º
- FinalReport (–∂—É—Ä–Ω–∞–ª —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)

### Phase 4 - Localization
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (DE/EN/RU)
- Resources —Ñ–∞–π–ª—ã
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞

---

## üí° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—á–µ–º—É async/await –≤–º–µ—Å—Ç–æ Stored Procedures?
**–°—Ç–∞—Ä—ã–π QIM:**
```sql
CREATE PROCEDURE GetNextClientCode
    @BusinessId INT,
    @Code INT OUTPUT
AS BEGIN
    SELECT @Code = ISNULL(MAX(Code), 200000) + 1 FROM Clients
END
```

**–ù–æ–≤—ã–π QIMy:**
```csharp
private async Task<int> GenerateNextClientCodeAsync(ClientArea clientArea)
{
    // C# –∫–æ–¥ —Å LINQ
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –õ–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (unit tests)
- ‚úÖ –õ—É—á—à–µ –¥–ª—è Code Review
- ‚úÖ –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- ‚úÖ –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç SQL Server

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏

1. **–°–µ–≥–æ–¥–Ω—è:**
   - ‚úÖ ClientCode, ClientType, ClientArea - –ì–û–¢–û–í–û
   - ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –æ–±–ª–∞—Å—Ç—è–º–∏

2. **–ó–∞–≤—Ç—Ä–∞:**
   - CSV Export –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –§–∏–ª—å—Ç—Ä—ã –ø–æ ClientType –∏ ClientArea –≤ —Å–ø–∏—Å–∫–µ

3. **–ü–æ—Å–ª–µ –∑–∞–≤—Ç—Ä–∞:**
   - PDF Invoice generation —Å QuestPDF
   - Email –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—á–µ—Ç–æ–≤

---

## üéì –ß—Ç–æ —É–∑–Ω–∞–ª–∏ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ QIM

1. **–ù—É–º–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –æ–±–ª–∞—Å—Ç—è–º** - –≥–µ–Ω–∏–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É—á–µ—Ç–∞
2. **ClientType + ClientArea** - –≤–ª–∏—è–µ—Ç –Ω–∞ –Ω–∞–ª–æ–≥–∏ –∏ –æ—Ç—á–µ—Ç—ã
3. **VIES integration** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ñ–∏—á–∞ –¥–ª—è B2B
4. **CSV Export/Import** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å BMD/Exact/SAP
5. **Generic Base Controllers** - —É–º–µ–Ω—å—à–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

---

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

QIMy —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç:
- ‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ —Ç–∏–ø–∞–º –∏ –æ–±–ª–∞—Å—Ç—è–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–¥–æ–≤
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
- ‚úÖ –ü–æ–ª–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ª–æ–≥–∏–∫–æ–π —Å—Ç–∞—Ä–æ–≥–æ QIM

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞:** http://localhost:5000

**–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ! üöÄ**
