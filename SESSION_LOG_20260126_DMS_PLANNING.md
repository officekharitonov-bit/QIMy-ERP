# Session Log - 26 —è–Ω–≤–∞—Ä—è 2026: Document Management System Planning

**–î–∞—Ç–∞:** 26.01.2026
**–¢–∏–ø —Å–µ—Å—Å–∏–∏:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
**–°—Ç–∞—Ç—É—Å:** –û—Ç–ª–æ–∂–µ–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## –ö–û–ù–¢–ï–ö–°–¢ –°–ï–°–°–ò–ò

### –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Ä–∞–±–æ—Ç–∞
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å (BusinessId –≤–µ–∑–¥–µ)
2. ‚úÖ –û—á–∏—â–µ–Ω–∞ –ë–î –æ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø–∞–ø–∫–∞ BKHA GmbH –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
4. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ CSV:
   - `PrepareClientsImport.ps1` ‚Üí 1 –∫–ª–∏–µ–Ω—Ç –≥–æ—Ç–æ–≤
   - `PrepareSuppliersImport.ps1` ‚Üí 9 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≥–æ—Ç–æ–≤–æ

### –ù–æ–≤–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ
**–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
> "—è —Ö–æ—á—É —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫ —á—Ç–æ–±—ã –≤ QIMy, –±—ã–ª–∞ —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è - —è –∑–∞–≥—Ä—É–∂–∞—é –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ —Ç–æ–ª—å–∫–æ —á—Ç–æ - C:\Projects\QIMy\tabellen\BKHA GmbH), –∞ QIMy - —Å–æ–∑–¥–∞—ë—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞"

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- –ü–∞–ø–∫–∞ `FA und ZOLL` ‚Üí –¥–æ–∫—É–º–µ–Ω—Ç `Bescheid UID Nummer.pdf`
- –°–∏—Å—Ç–µ–º–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç UID –Ω–æ–º–µ—Ä (ATU12345678)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Å–∏—Å—Ç–µ–º—É
- –í –ø–æ–ª–µ Business.VatNumber –¥–æ–±–∞–≤–ª—è–µ—Ç –∏–∫–æ–Ω–∫—É üìÑ
- –ö–ª–∏–∫ –Ω–∞ –∏–∫–æ–Ω–∫—É ‚Üí –ø—Ä–æ—Å–º–æ—Ç—Ä PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–¶–µ–ª—å:** –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ (DMS) —Å —É–º–Ω—ã–º –∏–º–ø–æ—Ä—Ç–æ–º

---

## –°–û–ó–î–ê–ù–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –î–æ–∫—É–º–µ–Ω—Ç
üìÑ **DOCUMENT_MANAGEMENT_SYSTEM_PLAN.md** (6500+ —Å—Ç—Ä–æ–∫)

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. Database Schema
```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
Documents (Id, FileName, ContentType, FileSizeBytes, FileData/StoragePath,
           DocumentType, ExtractedText, ExtractedDataJson, BusinessId)

-- –°–≤—è–∑—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏ (–ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–∞—è)
DocumentAttachments (DocumentId, EntityType, EntityId, FieldName)

-- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
DocumentVersions (DocumentId, VersionNumber, FileData, ChangeComment)
```

#### 2. Domain Entities
- `Document.cs` - –æ—Å–Ω–æ–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `DocumentAttachment.cs` - —Å–≤—è–∑—å –¥–æ–∫—É–º–µ–Ω—Ç ‚Üî —Å—É—â–Ω–æ—Å—Ç—å
- `DocumentVersion.cs` - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `DocumentStorageType` enum (Database/FileSystem)

#### 3. Services
```csharp
IDocumentService - Upload, Download, Attach, Delete, Archive
IDocumentParserService - Extract text/fields from PDF
ISmartImportService - Analyze folder, Import entire structure
```

#### 4. Smart Import Rules
**Folder Detection:**
- `FA und ZOLL` ‚Üí Tax & Customs documents
- `STAMM` ‚Üí Company master data
- `BANK` ‚Üí Banking documents
- `BH` ‚Üí Accounting data (CSV)
- `Rechnungen` ‚Üí Invoices

**Document Type Patterns:**
- Filename contains "UID" ‚Üí UIDCertificate ‚Üí Extract VatNumber
- Filename contains "EORI" ‚Üí EORICertificate ‚Üí Extract CustomsNumber
- Filename contains "IBAN" ‚Üí IBANCertificate ‚Üí Extract BankAccount
- Filename contains "Firmenbuch" ‚Üí CompanyRegistration ‚Üí Extract FN

**Field Extraction (Regex):**
```regex
UID: ATU\d{8}
EORI: AT[A-Z0-9]+
FN: FN\s*\d+\w?
IBAN: AT\d{2}\s*\d{4}\s*\d{4}\s*\d{4}\s*\d{4}
```

#### 5. UI Components
```razor
<DocumentUploadComponent />          // Drag & Drop upload
<DocumentFieldAttachment />          // üìÑ icon next to field
<DocumentViewerModal />              // PDF/Image viewer
/Admin/SmartImport/Index.razor       // Folder import wizard
```

#### 6. CQRS Commands
- `UploadDocumentCommand` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
- `AttachDocumentCommand` - –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Å—É—â–Ω–æ—Å—Ç–∏/–ø–æ–ª—é
- `ImportFolderCommand` - –∏–º–ø–æ—Ä—Ç –≤—Å–µ–π –ø–∞–ø–∫–∏

---

## IMPLEMENTATION ROADMAP

### Phase 1: Core DMS (1-2 –¥–Ω—è)
- [ ] Create Document entities (Document, DocumentAttachment, DocumentVersion)
- [ ] Database migration
- [ ] DocumentService implementation
- [ ] API endpoints (Upload, Download, Delete)
- [ ] Basic UI components

### Phase 2: Document Parsing (1 –¥–µ–Ω—å)
- [ ] Integrate PDF parser (iTextSharp/PdfPig)
- [ ] DocumentParserService
- [ ] Regex patterns for field extraction
- [ ] Test on real PDFs from BKHA GmbH

### Phase 3: UI Integration (1 –¥–µ–Ω—å)
- [ ] DocumentFieldAttachment component
- [ ] Add üìÑ icons to Business/Client/Supplier forms
- [ ] DocumentViewerModal
- [ ] Document list on each entity page

### Phase 4: Smart Import (2-3 –¥–Ω—è)
- [ ] FolderAnalyzer service
- [ ] SmartImportService implementation
- [ ] ImportFolderCommand + Handler
- [ ] Smart Import wizard UI
- [ ] Test with BKHA GmbH folder

### Phase 5: Advanced Features (1-2 –¥–Ω—è)
- [ ] Document versioning
- [ ] Full-text search (ExtractedText)
- [ ] Archive old documents
- [ ] Document permissions

**Total estimate:** 7-9 –¥–Ω–µ–π —Ä–∞–±–æ—Ç—ã

---

## –¢–ï–•–ù–û–õ–û–ì–ò–ò

### Backend
- **PDF Parser:** iTextSharp 8.x –∏–ª–∏ PdfPig
- **OCR (optional):** Tesseract.NET –¥–ª—è —Å–∫–∞–Ω–æ–≤
- **Storage:** Database BLOB (SQLite) ‚Üí FileSystem later

### Frontend
- **File Upload:** Blazor InputFile
- **Drag & Drop:** HTML5 API
- **PDF Viewer:** `<iframe>` —Å data URL –∏–ª–∏ PDF.js
- **Icons:** Unicode üìÑüìéüìã

### Configuration
- **File Size Limit:** 50 MB per file
- **Allowed Types:** PDF, JPG, PNG, CSV, XLSX
- **Storage Path:** `wwwroot/uploads/{businessId}/{year}/{month}/`

---

## –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### Scenario: Import BKHA GmbH folder

```csharp
// 1. User selects folder: C:\Projects\QIMy\tabellen\BKHA GmbH
var command = new ImportFolderCommand(
    FolderPath: @"C:\Projects\QIMy\tabellen\BKHA GmbH",
    BusinessId: 2
);

// 2. System analyzes structure:
// FA und ZOLL/
//   ‚îú‚îÄ‚îÄ Bescheid UID Nummer.pdf ‚Üí Detect: UIDCertificate
//   ‚îî‚îÄ‚îÄ EORI-Antrag.pdf ‚Üí Detect: EORICertificate
// BH/
//   ‚îú‚îÄ‚îÄ PK 2025.csv ‚Üí Detect: Personenkonten
//   ‚îî‚îÄ‚îÄ Sachkonten 2025.csv ‚Üí Detect: ChartOfAccounts

// 3. System processes:
// - Upload "Bescheid UID Nummer.pdf"
// - Extract text with PDF parser
// - Find "ATU12345678" with regex
// - Update Business.VatNumber = "ATU12345678"
// - Create DocumentAttachment(EntityType: "Business", EntityId: 2, FieldName: "VatNumber")
// - Import PK 2025.csv ‚Üí 1 Client + 9 Suppliers
// - Import Sachkonten 2025.csv ‚Üí 92 Accounts

// 4. Result:
var result = await _mediator.Send(command);
// result.ClientsImported = 1
// result.SuppliersImported = 9
// result.AccountsImported = 92
// result.DocumentsUploaded = 6
// result.AttachmentsCreated = 6
```

### UI After Import

**Business Edit Page:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Company Name: BKHA GmbH             ‚îÇ
‚îÇ UID Number:   ATU12345678  [üìÑ]     ‚îÇ ‚Üê Click ‚Üí View PDF
‚îÇ EORI:         AT123456789  [üìÑ]     ‚îÇ ‚Üê Click ‚Üí View PDF
‚îÇ IBAN:         AT61...      [üìÑ]     ‚îÇ ‚Üê Click ‚Üí View PDF
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## SECURITY CONSIDERATIONS

```csharp
// Document access control
public enum DocumentPermission
{
    ViewDocument,
    UploadDocument,
    DeleteDocument,
    ArchiveDocument,
    ViewAllBusinessDocuments  // Admin only
}

// Handler validation
if (document.BusinessId != currentBusinessId)
    throw new UnauthorizedBusinessAccessException("Document", documentId);
```

---

## OPEN QUESTIONS

1. **Storage strategy:** Database BLOB vs FileSystem?
   - **Recommendation:** FileSystem –¥–ª—è —Ñ–∞–π–ª–æ–≤ >1MB
   - Database —Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

2. **OCR needed now?**
   - **Recommendation:** Phase 2, optional –¥–ª—è —Å–∫–∞–Ω–æ–≤ –±–µ–∑ —Ç–µ–∫—Å—Ç–∞

3. **Document versioning mandatory in Phase 1?**
   - **Recommendation:** Phase 5, –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è MVP

4. **Max file size: 50 MB enough?**
   - **Recommendation:** 50 MB –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è PDF/images

5. **Start implementation now or finish manual BKHA import first?**
   - **Decision:** –û—Ç–ª–æ–∂–µ–Ω–æ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–æ—Å—Ç–∞–≤–∏–º –ø–æ–∫–∞")

---

## –†–ï–®–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

**–°—Ç–∞—Ç—É—Å:** ‚è∏Ô∏è –û–¢–õ–û–ñ–ï–ù–û

**–¶–∏—Ç–∞—Ç–∞:**
> "–æ—Å—Ç–∞–≤–∏–º –ø–æ–∫–∞, –Ω–æ –∑–∞–ø–æ–º–Ω–∏ –ø–ª–∞–Ω - —Å–æ–∑–¥–∞–π –ª–æ–≥–∏"

**Next steps:**
1. ‚úÖ –ü–ª–∞–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ DOCUMENT_MANAGEMENT_SYSTEM_PLAN.md
2. ‚úÖ Session log —Å–æ–∑–¥–∞–Ω
3. ‚è≥ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä—É—á–Ω–æ–º—É –∏–º–ø–æ—Ä—Ç—É BKHA GmbH:
   - Import Clients_BKHA_Import.csv (1 client)
   - Import Suppliers_BKHA_Import.csv (9 suppliers)
   - Extract company details from PDFs manually
   - Import Sachkonten (92 accounts)

**Future implementation:** –ö–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞, –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ DMS (7-9 –¥–Ω–µ–π —Ä–∞–±–æ—Ç—ã)

---

## –°–í–Ø–ó–ê–ù–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´

- üìÑ [DOCUMENT_MANAGEMENT_SYSTEM_PLAN.md](DOCUMENT_MANAGEMENT_SYSTEM_PLAN.md) - Full architecture
- üìÑ [BKHA_IMPORT_PLAN.md](BKHA_IMPORT_PLAN.md) - Current manual import plan
- üìÑ [AI_CONTEXT.md](AI_CONTEXT.md) - System context
- üìÑ [INDEX_AI_MEMORY_SYSTEM.md](INDEX_AI_MEMORY_SYSTEM.md) - Memory index

---

## –í–´–í–û–î–´

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞:** –ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω –∏–∑ 13 —Ä–∞–∑–¥–µ–ª–æ–≤ —Å –∫–æ–¥–æ–º
2. **Scope –ø–æ–Ω—è—Ç–µ–Ω:** 5 —Ñ–∞–∑, 7-9 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
3. **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤—ã–±—Ä–∞–Ω—ã:** iTextSharp + Blazor InputFile + FileSystem storage
4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –û—Ç–ª–æ–∂–µ–Ω–æ, —Å–Ω–∞—á–∞–ª–∞ –¥–æ–¥–µ–ª–∞—Ç—å –±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ DMS –ø–æ—Å–ª–µ:
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏—è CQRS –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- –ò–º–ø–æ—Ä—Ç–∞ –ø–µ—Ä–≤—ã—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (BKHA GmbH)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
